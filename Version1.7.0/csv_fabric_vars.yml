
- name: "Task 4.1: Copy original CSV file"
  copy:
    src: input/fabric_node.csv
    dest: input/csv_copies/{{ reference }}.csv
    mode: preserve

- name: "Task 4.2: Create File List for Jinja2 temps"
  include_vars: csv_vars/csv_vars.yml

- name: "Task 4.3: Read CSV file"
  read_csv:
    path: input/csv_copies/{{ reference }}.csv
  register: csv_values

- name: "Task 4.4: Create CDP Fabric YAML Vars"
  template:
    src: templates/csv_cdp.j2
    dest: output/cdp/{{ reference }}cdp.yml

- name: "Task 4.5: Create Port_Channel Fabric YAML Vars"
  template:
    src: templates/csv_pc.j2
    dest: output/pc/{{ reference }}pc.yml

- name: "Task 4.6: Create LLDP Fabric YAML Vars"
  template:
    src: templates/csv_lldp.j2
    dest: output/lldp/{{ reference }}lldp.yml

- name: "Task 4.7: Insert Fabric Marker"
  blockinfile:
    block: "{{ lookup('file', 'output/cdp/{{ reference }}cdp.yml') }}"
    dest: host_vars/vars.yml
    marker: "# {mark} Ansible CDP Section"
    insertbefore: "lldp:"

- name: "Task 4.8: Insert Fabric Marker"
  blockinfile:
    block: "{{ lookup('file', 'output/lldp/{{ reference }}lldp.yml') }}"
    dest: host_vars/vars.yml
    marker: "# {mark} Ansible LLDP Section"
    insertbefore: "port_channel:"

- name: "Task 4.9: Insert Fabric Marker"
  blockinfile:
    block: "{{ lookup('file', 'output/pc/{{ reference }}pc.yml') }}"
    dest: host_vars/vars.yml
    marker: "# {mark} Ansible Port_Channel Section"
    insertbefore: "#EOI:"



